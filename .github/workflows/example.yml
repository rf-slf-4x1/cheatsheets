name: Build example

env:
  tex_input_file: 'example'
  pdfs_repository: 'https://github.com/rf-slf-4x1/cheatsheets-pdf'
  TOKEN: ${{secrets.TOKEN}}

on:
  push:
    paths: ['example.tex', 'def.tex']

jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v2
      - name: Build PDFs
        uses: dante-ev/latex-action@latest
        with:
          root_file: ${{tex_input_file}}.tex
          compiler: pdflatex
          args: -interaction=nonstopmode -shell-escape
      - name: Upload
        uses: actions/upload-artifact@master
        with:
          name: ${{tex_input_file}}.pdf
          path: ${{tex_input_file}}.pdf
        if: always()
      - name: Upload to work repo
        uses: GuillaumeFalourd/git-commit-push@v1.3
        with:
          target_branch: main
          commit_message: ${{ github.event.head_commit.message }}, work ${{tex_input_file}}
          files: ${{tex_input_file}}.pdf
          remote_repository: ${{pdfs_repository}}
          access_token: ${{TOKEN}}
          force: true
